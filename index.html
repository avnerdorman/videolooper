<!DOCTYPE html>
<html>
<script src="https://www.youtube.com/iframe_api"></script>

<body>
    <h1>Custom YouTube Looper</h1>
    <!-- Input fields for user to provide the YouTube link, start time and end time of the video clip they want to loop -->
    <label for="link">YouTube Link:</label><br>
    <input type="text" id="link"><br>
    <label for="start">Start Time (hh:mm:ss, mm:ss, or ss):</label><br>
    <input type="text" id="start"><br>
    <label for="end">End Time (hh:mm:ss, mm:ss, or ss):</label><br>
    <input type="text" id="end"><br>
    
    <!-- Sliders for visual selection of start and end time -->
    <label for="start-slider">Start Time:</label><br>
    <input type="range" id="start-slider" min="0" max="1" value="0" oninput="updateStartTime(this.value)">
    <span id="start-time-display">00:00:00</span><br>
    <label for="end-slider">End Time:</label><br>
    <input type="range" id="end-slider" min="0" max="1" value="1" oninput="updateEndTime(this.value)">
    <span id="end-time-display">00:00:00</span><br>
    
    <!-- Button to load the video and update video according to new time ranges -->
    <button onclick="loadPlayer()">Load Video</button>
    <button id="update">Update Video</button>

    <!-- Div where the YouTube player will be inserted -->
    <div id="player"></div>

    <script>
      var player;  // This will hold the YouTube player object
      var start;  // The start time of the loop in seconds
      var end;  // The end time of the loop in seconds

      // This function loads the YouTube video and initiates the player
      function loadPlayer() {
        // Extract the video ID from the URL
        var link = document.getElementById('link').value;
        var video_id = extractVideoID(link);
        
        // Convert the start and end times to seconds
        var startTime = document.getElementById('start').value;
        var endTime = document.getElementById('end').value;
        start = convertTimeToSeconds(startTime);
        end = convertTimeToSeconds(endTime);

        // Create a new YouTube player
        player = new YT.Player('player', {
          height: '360',
          width: '640',
          videoId: video_id,
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }

      // This function extracts the video ID from a YouTube link
      function extractVideoID(link) {
        // Continue with your existing logic for extracting the video ID
      }

      // This function converts a time string to seconds
      function convertTimeToSeconds(time) {
        // Continue with your existing logic for time conversion
      }

      // This function is called when the player's state changes
      function onPlayerStateChange(event) {
        // If the video is playing, stop the video loop after the end time is reached
        if (event.data == YT.PlayerState.PLAYING) {
          setTimeout(stopVideoLoop, (end - start) * 1000);
        }
      }

      // This function seeks the video to the start time
      function stopVideoLoop() {
        player.seekTo(start);
      }

      // This code loads the IFrame Player API code asynchronously.
      var tag = document.createElement('script');
      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      // This function updates the start and end times when the "Update Video" button is clicked
      document.getElementById('update').onclick = function() {
        player.stopVideo();
        start = parseInt(document.getElementById('start-slider').value);
        end = parseInt(document.getElementById('end-slider').value);
        player.seekTo(start);
        player.playVideo();
      };

      // These functions update the start and end times when the sliders are adjusted
      function updateStartTime(value) {
        // Continue with your existing logic for updating the start time
      }

      function updateEndTime(value) {
        // Continue with your existing logic for updating the end time
      }

      // This function formats a number of seconds into a string in hh:mm:ss format
      function formatTime(seconds) {
        // Continue with your existing logic for time formatting
      }

      // This function is called when the player is ready
      function onPlayerReady(event) {
        event.target.seekTo(start);
        event.target.playVideo();
        
        // Update the max values of the sliders to match the video duration
        var duration = player.getDuration();
        document.getElementById('start-slider').max = duration;
        document.getElementById('end-slider').max = duration;
        
        // Update the value of the start time slider and the text of the end time display
        document.getElementById('start-slider').value = start;
        document.getElementById('end-time-display').textContent = formatTime(duration);
      }

      // Add event listeners to the start and end time input fields to update the sliders when the input values change
      var startTimeBox = document.getElementById('start');
      startTimeBox.addEventListener('input', function() {
        var timeInSeconds = convertTimeToSeconds(this.value);
        document.getElementById('start-slider').value = timeInSeconds;
      });

      var endTimeBox = document.getElementById('end');
      endTimeBox.addEventListener('input', function() {
        var timeInSeconds = convertTimeToSeconds(this.value);
        document.getElementById('end-slider').value = timeInSeconds;
      });
        
    </script>
</body>
</html>
